# TOX configuration file. See (https://tox.readthedocs.io/)
#
# Setup:
# $ python3 -m venv venv
# $ source venv/bin/activate    # (Windows: venv\Scripts\activate)
# (venv) $ pip install -U pip setuptools
# (venv) $ pip install deps/qecsim-1.0b2-py3-none-any.whl  # TODO: remove here and in envs when qecsim on PyPI
# (venv) $ pip install -e .[dev]
#
# Run tests in ./tests/:
# (venv) $ tox
#
# Run tests with coverage in ./tests/:
# (venv) $ tox -ecov
#
# Generate documentation zip in ./dist/:
# (venv) $ tox -edocs
#
# Build source and binary distributables in ./dist/:
# (venv) $ tox -ebuild
#

[tox]
envlist = py3

[testenv]
deps =
    deps/qecsim-1.0b2-py3-none-any.whl
    pytest
commands =
    pytest --basetemp="{envtmpdir}" {posargs}

[testenv:cov]
deps =
    deps/qecsim-1.0b2-py3-none-any.whl
    pytest
    pytest-cov
commands =
    pytest --basetemp="{envtmpdir}" --cov="{envsitepackagesdir}/qecsimext" {posargs}

[testenv:docs]
deps =
    deps/qecsim-1.0b2-py3-none-any.whl
    sphinx
    sphinx_rtd_theme
commands =
    sphinx-build -W -bhtml -d"{envtmpdir}/doctrees" ./docs "{envtmpdir}/html/qecsimext"
    python -c "import shutil, qecsimext; shutil.make_archive(f'dist/qecsimext-\{qecsimext.__version__\}-docs', 'zip', r'{envtmpdir}/html', 'qecsimext')"

[testenv:build]
skip_install = true
deps =
    docutils
    wheel
commands =
    python setup.py check -mrs
    python setup.py build --build-base="{envtmpdir}/build" sdist bdist_wheel


# tool configurations
[pytest]
testpaths = tests
addopts = --verbose

[check-manifest]
ignore =
    tox.ini
    deps/**
    docs/**
    tests/**
